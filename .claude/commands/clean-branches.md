---
allowed-tools: Bash(git:*)
description: "不要なブランチを検出して削除する"
---

# clean-branches

マージ済みや不要なローカル・リモートブランチを検出し、確認後に削除するコマンド。

## 手順

1. `git fetch --prune` を実行してリモートの情報を最新化し、削除済みリモートブランチの追跡を解除する
2. 現在のブランチを `git branch --show-current` で確認する
3. マージ済みのローカルブランチを `git branch --merged` で一覧表示する
   - main/master/develop ブランチは保護対象として除外する
   - 現在チェックアウト中のブランチも除外する
4. リモートで削除済みだがローカルに残っている追跡ブランチを確認する
   - `git branch -vv` で "gone" と表示されるブランチを特定する
5. 削除対象のブランチ一覧をユーザーに提示し、削除してよいか確認する
6. ユーザーの承認後、対象ブランチを削除する
   - ローカルブランチ: `git branch -d <branch>` （マージ済みの場合）
   - 強制削除が必要な場合は `git branch -D <branch>` を使用するが、必ずユーザーに確認する

## 重要な制約

- **main, master, develop ブランチは絶対に削除しない**
- **現在チェックアウト中のブランチは削除しない**
- 削除前に必ずユーザーの確認を取る
- リモートブランチの削除（`git push origin --delete`）は行わない（ローカルのみ対象）
- 不明な場合は安全側に倒し、削除しない
